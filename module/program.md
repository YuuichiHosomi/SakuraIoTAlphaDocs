# プログラミングガイド

## さくらのIoT Platform αの概念

![さくらのIoT Platform α 概念図](../imgs/iot-platform.png)

## フォーマット

### サンプル
※注意: このサンプルでは見やすいように改行してありますが、実際に送信する際は改行を含まないよう1行にまとめてください。

```
{
    "module": "hogehogehoge",
    "type": "channels",
    "datetime": "2016-06-01T12:21:11.628907163Z",
    "payload": {
        "channels": [{
                "channel": 1,
                "type": "i",
                "value": 1
            }
        ]
    }
}
```

### <a name="channel_type">型指定子
チャンネルの値の型を示す文字です。

|型|C言語における型|型指定子|
|:----|:--------------|:-------|
|符号あり32bit整数|int32_t|i|
|符号なし32bit整数|uint32_t|I|
|符号あり64bit整数|int64_t|l|
|符号なし64bit整数|uint64_t|L|
|32bit浮動小数点数|float|f|
|64bit浮動小数点数|double|d|
|8バイトの配列|byte[8]|b|



### 解説
基本的にモジュール→プラットフォーム、プラットフォーム→モジュールの両方向で同じデータ形式を使用します。

モジュールIDにはコントロールパネルトップページに表示される`ID`欄の文字列(図中赤矢印、module_idの部分)を使用してください。

![モジュールIDの表示位置](../imgs/module-id.png)



α版現在ではプラットフォーム→モジュール方向ではdatetimeは意味を持ちませんが、指定しないと正常に処理が行われません。任意の日時(例: `2016-06-01T12:21:11.628907163Z` など)を指定してください。

以下に実際のJSONとコメント(// 以降)を示します。

```
{
    "module": "hogehogehoge",    // 送信先モジュールIDを指定します
    "type": "channels",    // 現時点ではチャンネルデータの送受信にのみ対応しています。変更しないでください。
    "datetime": "2016-06-01T12:21:11.628907163Z",    // モジュールからデータを受け取った日時を表します。モジュールへデータを送信したい際には右のサンプル等適当な値を指定してください。
    "payload": {
        "channels": [ // 同時に複数チャンネルにデータを送信することが可能です
            {
                "channel": 1, // 送信先チャンネル
                "type": "i", // 型
                "value": 1 // データ
            },
            {
                "channel": 2, // 送信先チャンネル
                "type": "b", // 型
                "value": "0f1e2d3c4b5c6b7a" // データ
            }
        ]
    }
}
```

## 送信モード
複数の送信モードが用意されており、使い方によって送信モードを切替えることでデータ量の削減等に役立てることが出来ます。

|名称|値|解説|
|:---|:---|:---|
|None|0x00|チャンネルに値が設定されても一切送信を行いません。|
|Auto|0x01|チャンネルに値が設定される度にデータを送信します。|
|Once|0x02|Onceモードに設定後、最初の1回のみチャンネルに設定された値を送信します。値の送信後は自動的にNoneモードに遷移します。|
|それ以外|N/A|将来のために予約されています。設定しないでください。|

## 通信方式特有の事柄

### UART(シリアルポート)を用いたデータ入出力
当初シリアル通信でもSPI/I2Cと同じようなプロトコルで通信出来るようにする予定でしたが、シリアルではコマンドシェルを提供することになったために違ったコマンド体系となっています。

`settx`, `gettx`, `setrx`, `getrx`等のコマンドを用いてチャンネルの値を読み書きすることが可能です。

コマンドシェルの詳しい使い方に関しては[さくらのIoT Platform α シェルリファレンス](./shell.md)をご覧ください。
